<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="author" content="DINAMO Networks">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>LGPD Protect</title>

    <link rel=icon href=https://service.dinamonetworks.io/favicon.ico />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.6.15/dist/css/uikit.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.6.15/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.6.15/dist/js/uikit-icons.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

    <style>
      .bg {
        background-color: #2D3C3F;
      }

      .dnc {
        color: rgb(193, 168, 52);
        font-size: 28px;
        padding-top: 35px;
      }

      .cpr {
        padding-top: 10px;
        font-size: 13px;
        font-family: Open Sans, sans-serif;
      }

      .ftr {
        background-color: #EDF0F1;
      }
    </style>

  </head>

  <body uk-height-viewport class="bg uk-flex uk-background-muted uk-flex-center">

    <span class="uk-display-block uk-text-center uk-position-top uk-flex uk-flex-center uk-padding-large">
    <img src="https://service.dinamonetworks.io/img/supercloud_white.14d8dea4.png" alt="Logo" width="356px" height="54px" />
    <span class="dnc uk-display-block uk-text-center">LGPD Protect</span>
    </span>

    <span class="uk-flex uk-flex-middle uk-flex-center uk-margin-top uk-width-3-4">
      <div class="uk-margin-xlarge-top uk-width-1-2">
        <form class="uk-form-stacked" id="app">
          <div class="uk-form-controls uk-margin">
            <div class="uk-placeholder uk-width-1-1">
              <span v-model="file_info" class="uk-display-block uk-text-bold uk-text-muted">{{ file_info }}</span>
              <span v-model="op_info" class="uk-display-block uk-text-muted">{{ op_info }}</span>
              <progress id="fet_prg" class="uk-flex uk-flex-middle uk-flex-center uk-progress" value="0" max="100"></progress>
              <span class="uk-flex uk-flex-center">
                <input v-model="pwd" type="password" placeholder="senha" class="uk-input uk-text-center uk-width-1-2"/>
              </span>
            </div>
            <div class="uk-width-1-1 uk-margin-top uk-text-center uk-margin-xlarge-bottom">
              <div class="js-upload uk-margin-top" uk-form-custom>
                <input type="file" id="enc_file" name="enc_file" accept="*">
                <button class="uk-button uk-button-primary" tabindex="-1">Encriptar</button>
              </div>
              <span class="uk-display-block-inline uk-margin-left uk-margin-right"></span>
              <div class="js-upload uk-margin-top" uk-form-custom>
                <input type="file" id="dec_file" name="dec_file" accept="*">
                <button class="uk-button uk-button-danger" tabindex="-1">Decriptar</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </span>

    <span class="ftr uk-display-block uk-text-center uk-position-bottom uk-flex uk-flex-center uk-padding">
      <img src="https://service.dinamonetworks.io/img/logo_dinamo_high_dark.630843f3.png" alt="SC" width="130px" width="36px" uk-img />
      <span class="uk-display-block uk-text-center cpr">Copyright Â© 2021</span>
    </span>

    <script src="/fet_core.js" type="module"></script>
    <script type="module">
    // ----------------------------------------------

    import * as fet from "/fet_core.js";

    // ----------------------------------------------

    function setup_file(vc, fid, rst, on_load) {
	    rst(vc);

	    let file = $(fid);

	    file[0].value = "";

	    file.on("change", function() {
		    rst(vc);

		    if ( !check_frm(vc) ) {
			    return false;
		    }

		    let f = new FileReader();

		    f.onload = function() {
			    vc.file_name = file[0].files[0].name;
			    vc.file_size = file[0].files[0].size;

			    on_load(vc, f);
		    };

		    f.readAsArrayBuffer(file[0].files[0]);
	    });
    }

    function clean_frm(vc) {
	    vc.file_info = "-";
	    vc.op_info   = "-";
	    vc.file_name = "";
	    vc.file_size = 0;
	    vc.iv        = [];
	    vc.salt      = [];
	    vc.d         = [];

	    set_progress(vc, "-", 0);
    }

    function check_frm(vc) {
	    if ( vc.pwd.length >= fet.MIN_PWD ) {
		    return true;
	    }

	    UIkit.modal.alert("Informe a senha com " + fet.MIN_PWD + " chars.");

	    return false;
    }

    function set_progress(vc, m, v) {
	    vc.op_info = ( m.length > 1 ) ? " => " + m : m;
	    $("#fet_prg")[0].value = v;
    }

    function error_cb(err) {
	    UIkit.modal.alert("Falha de criptografia.");
	    console.log(err);
    }

    fet.set_progress(set_progress);
    fet.set_error(error_cb);

    new Vue({
	    el: "#app",

	    data: {
		    pwd: "",
		    file_info: "-",
		    op_info: "-",
		    file_name: "",
		    file_size: 0,
		    iv: [],
		    salt: [],
		    d: []
	    },

	    mounted: function() {
		    setup_file(this, "#enc_file", clean_frm, fet.encrypt);
		    setup_file(this, "#dec_file", clean_frm, fet.decrypt);
	    },

	    methods: {}
    });
    </script>

  </body>
</html>
